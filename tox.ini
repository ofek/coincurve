[tox]
skip_missing_interpreters = true
envlist =
    py{2.7,3.6,3.7,3.8,3.9,py3},
    bench,
    style

[testenv]
passenv = *
deps =
    -rrequirements-dev.txt
commands =
    python -c "import shutil; shutil.move('coincurve', '_coincurve')"
    coverage run --parallel-mode -m pytest -v --benchmark-skip {posargs}
    python -c "import shutil; shutil.move('_coincurve', 'coincurve')"
    coverage combine
    coverage report -m

[testenv:bench]
skip_install = true
envdir = {toxworkdir}/py{env:PYTHON_VERSION:bench}
commands =
    python -c "import shutil; shutil.move('coincurve', '_coincurve')"
    pytest -v --benchmark-only --benchmark-sort=name --benchmark-cprofile=tottime
    python -c "import shutil; shutil.move('_coincurve', 'coincurve')"

[testenv:style]
skip_install = true
deps = black
commands = black --check --diff .
